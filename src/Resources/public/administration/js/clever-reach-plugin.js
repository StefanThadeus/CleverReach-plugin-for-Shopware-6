!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/bundles/cleverreachplugin/",n(n.s="wEu0")}({"1oTA":function(e,t,n){var r=n("MiCx");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("SZ7m").default)("c8ac5bac",r,!0,{})},"2CG9":function(e,t,n){var r=n("bDfb");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("SZ7m").default)("9a207f10",r,!0,{})},BPCN:function(e,t,n){},MiCx:function(e,t,n){},SZ7m:function(e,t,n){"use strict";function r(e,t){for(var n=[],r={},o=0;o<t.length;o++){var c=t[o],i=c[0],a={id:e+":"+o,css:c[1],media:c[2],sourceMap:c[3]};r[i]?r[i].parts.push(a):n.push(r[i]={id:i,parts:[a]})}return n}n.r(t),n.d(t,"default",(function(){return p}));var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var c={},i=o&&(document.head||document.getElementsByTagName("head")[0]),a=null,s=0,u=!1,l=function(){},h=null,f="data-vue-ssr-id",d="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function p(e,t,n,o){u=n,h=o||{};var i=r(e,t);return v(i),function(t){for(var n=[],o=0;o<i.length;o++){var a=i[o];(s=c[a.id]).refs--,n.push(s)}t?v(i=r(e,t)):i=[];for(o=0;o<n.length;o++){var s;if(0===(s=n[o]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete c[s.id]}}}}function v(e){for(var t=0;t<e.length;t++){var n=e[t],r=c[n.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](n.parts[o]);for(;o<n.parts.length;o++)r.parts.push(y(n.parts[o]));r.parts.length>n.parts.length&&(r.parts.length=n.parts.length)}else{var i=[];for(o=0;o<n.parts.length;o++)i.push(y(n.parts[o]));c[n.id]={id:n.id,refs:1,parts:i}}}}function g(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function y(e){var t,n,r=document.querySelector("style["+f+'~="'+e.id+'"]');if(r){if(u)return l;r.parentNode.removeChild(r)}if(d){var o=s++;r=a||(a=g()),t=S.bind(null,r,o,!1),n=S.bind(null,r,o,!0)}else r=g(),t=C.bind(null,r),n=function(){r.parentNode.removeChild(r)};return t(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;t(e=r)}else n()}}var b,m=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function S(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=m(t,o);else{var c=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(c,i[t]):e.appendChild(c)}}function C(e,t){var n=t.css,r=t.media,o=t.sourceMap;if(r&&e.setAttribute("media",r),h.ssrId&&e.setAttribute(f,t.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},aF6T:function(e,t,n){var r=n("BPCN");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("SZ7m").default)("0f75a28c",r,!0,{})},bDfb:function(e,t,n){},wEu0:function(e,t,n){"use strict";n.r(t);n("aF6T");Shopware.Component.register("cleverreach-index",{template:'{% block cleverreach_index %}\n    <sw-page :showSearchBar="false" :showSmartBar="false">\n        <sw-card-view slot="content">\n            <div class="sw-cleverreach-index">\n                <img src="https://digimember.com/wp-content/uploads/2019/11/logo-cleverreach.png"  alt="logo"/>\n                <cleverreach-welcome v-if="this.$route.params.page===\'welcome\'"/>\n                <cleverreach-dashboard v-else-if="this.$route.params.page===\'dashboard\'"/>\n            </div>\n        </sw-card-view>\n    </sw-page>\n{% endblock %}\n',inject:["cleverreachService"],data:function(){return{isLoading:!0}},mounted:function(){this.getCurrentRoute({})},watch:{$route:function(e,t){var n={};e.hasOwnProperty("query")&&Object.keys(e.query).length>0?n=e.query:t.hasOwnProperty("query")&&Object.keys(t.query).length>0&&(n=t.query),this.getCurrentRoute(n)}},methods:{getCurrentRoute:function(e){var t=this;this.cleverreachService.getCurrentRoute().then((function(n){t.isLoading=!1;var r={name:"cleverreach.plugin.index",params:{page:n.page},query:e};t.$router.replace(r),t.isLoading=!1})).catch((function(e){console.log(e)}))}}});n("1oTA");Shopware.Component.register("cleverreach-welcome",{template:'{% block cleverreach_welcome %}\n    <div class="sw-cleverreach-welcome">\n        <sw-loader v-if="isLoading" />\n        <div class="sw-cleverreach-form-container">\n            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT2TdpHAB5xbd5FhID_yZFp9fnQkh4fsRDnB0uwDEfD&s" alt="logo"/>\n            <h2>Welcome to CleverReach!</h2>\n            <p>Connect, synchronize customer data, and create appealing emails to showcase your products to your customers!</p>\n            <button @click="startAuthorizationProcess">Connect</button>\n        </div>\n    </div>\n{% endblock %}',inject:["cleverreachService"],data:function(){return{isLoading:!0,popup:null,currentTab:null}},mounted:function(){this.checkIfInitialSyncInProgress()},methods:{startAuthorizationProcess:function(){var e=this;this.cleverreachService.getRedirectUrl().then((function(t){e.redirectToConnectionPopup(t.redirectUrl)})).catch((function(e){console.log(e)}))},redirectToConnectionPopup:function(e){this.isLoading=!0,this.currentTab=window,this.popup=window.open(e,"_blank"),this.popup.focus(),this.checkClientConnectionStatus()},checkClientConnectionStatus:function(){var e=this;this.cleverreachService.checkConnectionStatus().then((function(t){if(t.isConnected)e.popup.close(),e.currentTab.focus(),window.location.reload();else{var n=e.checkClientConnectionStatus;setTimeout(n,250)}})).catch((function(e){console.log(e)}))},checkIfInitialSyncInProgress:function(){var e=this;this.cleverreachService.checkIfInitialSyncInProgress().then((function(t){!1===t.inProgress&&(e.isLoading=!1)})).catch((function(e){console.log(e)}))}}});n("2CG9");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return a(this,n)}}function a(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Shopware.Component.register("cleverreach-dashboard",{template:'{% block cleverreach_dashboard %}\n    <div class="sw-cleverreach-dashboard">\n        <sw-loader v-if="isLoading"/>\n        <div class="sw-cleverreach-form-container">\n            <div class="sw-cleverreach-header">\n                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT2TdpHAB5xbd5FhID_yZFp9fnQkh4fsRDnB0uwDEfD&s"\n                     alt="logo"/>\n                <p>Client ID: <span class="client-id">{{ clientId }}</span></p>\n            </div>\n            <div class="sw-cleverreach-sync-status">Sync status:\n                <span v-if="status === \'done\'" class="status-done">Done</span>\n                <span v-else-if="status === \'progress\'" class="status-progress">In progress</span>\n                <span v-else-if="status === \'error\'" class="status-error">Error</span>\n            </div>\n            <button @click="startSynchronizationProcess">Synchronize</button>\n        </div>\n    </div>\n{% endblock %}',inject:["cleverreachService"],data:function(){return{isLoading:!0,status:"progress",clientId:"ABC123"}},mounted:function(){this.fetchClientId(),this.checkClientConnectionStatus()},methods:{fetchClientId:function(){var e=this;this.cleverreachService.getClientId().then((function(t){e.clientId=t.clientId})).catch((function(e){console.log(e)}))},startSynchronizationProcess:function(){this.status="progress",this.cleverreachService.startManualSync().catch((function(e){console.log(e)})),this.checkManualSyncStatus()},checkManualSyncStatus:function(){var e=this;this.cleverreachService.checkConnectionStatus().then((function(t){if(t.isConnected)e.status="done";else{var n=e.checkManualSyncStatus;setTimeout(n,250)}})).catch((function(e){console.log(e)}))},checkClientConnectionStatus:function(){var e=this;this.cleverreachService.checkConnectionStatus().then((function(t){t.isConnected&&(e.status="done",e.isLoading=!1)})).catch((function(e){console.log(e)}))}}}),Shopware.Module.register("cleverreach-plugin",{type:"plugin",name:"clever-reach.basic.label",title:"clever-reach.basic.label",description:"clever-reach.basic.description",routes:{index:{component:"cleverreach-index",path:":page?"}},navigation:[{label:"CleverReach",color:"#ff3d58",path:"cleverreach.plugin.index",icon:"default-shopping-paper-bag-product",position:100,parent:"sw-marketing"}]});var u=Shopware.Classes.ApiService,l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(s,e);var t,n,r,a=i(s);function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=a.call(this,e,t,"cleverreach")).name="cleverreachService",n}return t=s,(n=[{key:"getCurrentRoute",value:function(){return this.httpClient.get("/cleverreach/router",{headers:this.getBasicHeaders()}).then((function(e){return u.handleResponse(e)}))}},{key:"checkConnectionStatus",value:function(){return this.httpClient.get("/cleverreach/connectionStatus",{headers:this.getBasicHeaders()}).then((function(e){return u.handleResponse(e)}))}},{key:"checkIfInitialSyncInProgress",value:function(){return this.httpClient.get("/cleverreach/initialSyncInProgress",{headers:this.getBasicHeaders()}).then((function(e){return u.handleResponse(e)}))}},{key:"getRedirectUrl",value:function(){return this.httpClient.get("/cleverreach/redirectUrl",{headers:this.getBasicHeaders()}).then((function(e){return u.handleResponse(e)}))}},{key:"startManualSync",value:function(){return this.httpClient.get("/cleverreach/manualSync",{headers:this.getBasicHeaders()}).then((function(e){return u.handleResponse(e)}))}},{key:"getClientId",value:function(){return this.httpClient.get("/cleverreach/getClientId",{headers:this.getBasicHeaders()}).then((function(e){return u.handleResponse(e)}))}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(u),h=Shopware.Application.getContainer("init");Shopware.Application.addServiceProvider("cleverreachService",(function(e){return new l(h.httpClient,e.loginService)}))}});